@set ARGS=%1 %2 %3 %4 %5 %6 %7 %8 %9
@if "%OS%" == "Windows_NT" setlocal
@cls
@echo off

@rem *------------------------------------------------------------------------*
@rem * シェル起動時のフォルダに移動.
@rem *------------------------------------------------------------------------*
@set SCRIPT=%~0
@for /f "delims=\ tokens=*" %%z in ("%SCRIPT%") do (
@set SCRIPT_CURRENT_DIR=%%~dpz )
@cd %SCRIPT_CURRENT_DIR%

@rem *------------------------------------------------------------------------*
@rem * JDKインストール先.
@rem * ※ 設定しない場合は何も指定しないでください.
@rem *------------------------------------------------------------------------*
@set SET_JAVA_HOME=

@rem *------------------------------------------------------------------------*
@rem * プロジェクトディレクトリ設定.
@rem *------------------------------------------------------------------------*
@set PROJ_DIR=.\

@rem *------------------------------------------------------------------------*
@rem * Javaオプション.
@rem *------------------------------------------------------------------------*
@set OPT=

@rem *------------------------------------------------------------------------*
@rem * 起動プログラムセット.
@rem *------------------------------------------------------------------------*
@set EXEC_PACKAGE=com.maachang.httpPush.HttpPush

@rem *------------------------------------------------------------------------*
@rem * 開始メモリ領域.
@rem * 単位はMByte
@rem *------------------------------------------------------------------------*
@set STM=1024

@rem *------------------------------------------------------------------------*
@rem * 最大メモリ領域.
@rem * 単位はMByte
@rem *------------------------------------------------------------------------*
@set EXM=1024

@rem *------------------------------------------------------------------------*
@rem * CompileThreshold(size).
@rem *------------------------------------------------------------------------*
@set CTHREAD=1000

@rem ##########################################################################
@rem # ※これ以下は設定しないでください.
@rem ##########################################################################

@rem *------------------------------------------------------------------------*
@rem * 設定条件反映.
@rem *------------------------------------------------------------------------*
@if not "%SET_JAVA_HOME%" == "" @set JAVA_HOME=%SET_JAVA_HOME%

@rem *------------------------------------------------------------------------*
@rem * 起動バッチディレクトリ.
@rem *------------------------------------------------------------------------*
@set BATCH_DIR=%PROJ_DIR%

@rem *------------------------------------------------------------------------*
@rem * 定義データ格納ディレクトリ.
@rem *------------------------------------------------------------------------*
@set CONF_DIR=%PROJ_DIR%conf

@rem *------------------------------------------------------------------------*
@rem * JAR格納ディレクトリ.
@rem *------------------------------------------------------------------------*
@set LIB_DIR=%PROJ_DIR%lib

@rem *------------------------------------------------------------------------*
@rem * log4j.
@rem *------------------------------------------------------------------------*
@set OPT=%OPT% -Dlog4j.configuration=file:%CONF_DIR%\log4j.xml

@rem *------------------------------------------------------------------------*
@rem * エラー判別.
@rem *------------------------------------------------------------------------*
@if "%JAVA_HOME%" == "" goto errJAVA_HOME
@if "%PROJ_DIR%" == "" goto errPROJ_DIR

@rem *------------------------------------------------------------------------*
@rem * execution java.
@rem *------------------------------------------------------------------------*

@call %BATCH_DIR%\core\parselib
@set CLASSPATH=.;%INST_LIB%

@set OPT=%OPT% -Djava.awt.headless=true
@set OPT=%OPT% -Djava.net.preferIPv4Stack=true
@set OPT=%OPT% -XX:+UseOnStackReplacement -XX:+UseCompilerSafepoints 
@set OPT=%OPT% -XX:CompileThreshold=%CTHREAD% -XX:+UseParallelGC
@set OPT=%OPT% -XX:+UseParallelOldGC -XX:+UseBiasedLocking
@set BASE_OPT=-Xms%STM%m -Xmx%EXM%m

@echo # startup httpPush.

@%JAVA_HOME%\bin\java -server %BASE_OPT% %OPT% %EXEC_PACKAGE% %ARGS%

goto end

@rem *------------------------------------------------------------------------*
@rem * エラー処理.
@rem *------------------------------------------------------------------------*

:errJAVA_HOME
@echo 環境変数 JAVA_HOME が設定されていません.
goto end

:errPROJ_DIR
@echo プロジェクトディレクトリが不正です.
goto end

@echo # exit httpPush.
:end
@if "%OS%" == "Windows_NT" endlocal
